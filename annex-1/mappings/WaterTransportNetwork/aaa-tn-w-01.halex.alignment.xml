<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<alignment xmlns="http://www.esdi-humboldt.eu/hale/alignment">
    <base prefix="ba2" location="../base-functions.halex.alignment.xml"/>
    <base prefix="ba1" location="../base-tn.halex.alignment.xml"/>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C6f9c3702-c3f2-44e4-b3ae-30c909310cb1" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="typeOfTransport" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
            </property>
        </target>
        <parameter value="water" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.join" id="C4ce2dafa-0c09-46d1-b006-f8b9d3156e12" priority="normal">
        <source name="types">
            <class>
                <type name="AX_WasserlaufType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0">
                    <condition lang="CQL">schifffahrtskategorie is not null or identnummer is not null</condition>
                </type>
            </class>
        </source>
        <source name="types">
            <class>
                <type name="AX_GewaesserachseType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </class>
        </source>
        <target>
            <class>
                <type name="WaterwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-w/4.0"/>
            </class>
        </target>
        <complexParameter name="join">
            <jp:join-parameter xmlns:jp="http://www.esdi-humboldt.eu/hale/join">
                <class>
                    <type name="AX_GewaesserachseType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                </class>
                <class>
                    <type name="AX_WasserlaufType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0">
                        <condition lang="CQL">schifffahrtskategorie is not null or identnummer is not null</condition>
                    </type>
                </class>
                <jp:condition>
                    <property>
                        <type name="AX_GewaesserachseType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="istTeilVon" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="href" ns="http://www.w3.org/1999/xlink"/>
                    </property>
                    <property>
                        <type name="AX_WasserlaufType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0">
                            <condition lang="CQL">schifffahrtskategorie is not null or identnummer is not null</condition>
                        </type>
                        <child name="identifier" ns="http://www.opengis.net/gml/3.2"/>
                    </property>
                </jp:condition>
            </jp:join-parameter>
        </complexParameter>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
// ID des Quell-Objekts
def sourceId = _source.p.id.value()

// ID des Quell-Wasserlaufs
def parentId = _source.links.AX_Wasserlauf.p.id.value()

if (parentId) {
	// nur falls ein Wasserlauf verfügbar ist, der die entsprechenden Bedingungen erfüllt
	// wird ein WaterwayLink erzeugt
	
	def _id = "WaterwayLink_$sourceId"
	
	_target {
	}
	
	withTransformationContext {
		def collect = _.context.collector(it)
		// Sammle ID für Netzwerk	
		collect.network &lt;&lt; _id
		// Sammle ID für Liste von WaterwayLinks für Wasserlauf
		collect.AX_Wasserlauf.links &lt;&lt; _id
	}
}
</core:text>
        </complexParameter>
        <documentation>Erstellt einen `WaterwayLink` zu einer `AX_Gewaesserachse` die Teil eines `AX_Wasserlauf`s ist, der wiederum zumindest über eine `schifffahrtskategorie` oder eine `identnummer` verfügen muss.

Der erstellte `WaterwayLink` wird dem Index von Netzwerk-Elementen hinzugefügt.

Für den entsprechenden `AX_Wasserlauf` wird hinterlegt, dass dieser `WaterwayLink` aus einer zugehörigen `AX_Gewaesserachse` erstellt wurde.
</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="Caae3ba1e-0a31-4dd7-9660-0c0c2a6ddd41" priority="normal">
        <source>
            <property>
                <type name="AX_GewaesserachseType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="lebenszeitintervall" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="AA_Lebenszeitintervall" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="beginnt" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="WaterwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-w/4.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
            </property>
        </target>
        <parameter value="false" name="structuralRename"/>
        <parameter value="false" name="ignoreNamespaces"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="Cd33efa37-4a17-47e7-9d11-3c6351116e85" priority="normal">
        <source>
            <property>
                <type name="AX_GewaesserachseType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="position" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="WaterwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-w/4.0"/>
                <child name="centrelineGeometry" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
            </property>
        </target>
        <parameter value="true" name="structuralRename"/>
        <parameter value="false" name="copyGeometries"/>
        <parameter value="true" name="ignoreNamespaces"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="Ce14a00f7-0f0f-425e-96bc-e278fa0d9678" priority="normal">
        <source>
            <property>
                <type name="AX_GewaesserachseType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="lebenszeitintervall" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="AA_Lebenszeitintervall" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="endet" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="WaterwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-w/4.0"/>
                <child name="endLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
            </property>
        </target>
        <parameter value="false" name="structuralRename"/>
        <parameter value="false" name="ignoreNamespaces"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Ce78abcd4-4f1e-4e80-9601-61885dc4185e" priority="normal">
        <target>
            <property>
                <type name="WaterwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-w/4.0"/>
                <child name="fictitious" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
            </property>
        </target>
        <parameter value="false" name="value"/>
    </cell>
    <cell relation="custom:alignment:adv.inspire.id.default" id="Cce74419d-0751-4c44-8a6b-5d4abb872a84" priority="normal">
        <source name="id">
            <property>
                <type name="AX_GewaesserachseType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="id" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </source>
        <target>
            <property>
                <type name="WaterwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-w/4.0"/>
                <child name="id" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.identifier" id="C1ba7c3de-dde9-42a8-bf41-3e0eb8d05787" priority="normal">
        <source name="id">
            <property>
                <type name="AX_GewaesserachseType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="id" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </source>
        <target>
            <property>
                <type name="WaterwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-w/4.0"/>
                <child name="identifier" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.id.default" id="C1323b69f-e907-4261-8bd9-b8fc0d01bab8" priority="normal">
        <source name="id">
            <property>
                <type name="AX_GewaesserachseType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="id" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </source>
        <target>
            <property>
                <type name="WaterwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-w/4.0"/>
                <child name="inspireId" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
                <child name="Identifier" ns="http://inspire.ec.europa.eu/schemas/base/3.3"/>
                <child name="localId" ns="http://inspire.ec.europa.eu/schemas/base/3.3"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.namespace" id="C5c0ab4cb-bfaf-4e08-886e-f42c5d121cd3" priority="normal">
        <target>
            <property>
                <type name="WaterwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-w/4.0"/>
                <child name="inspireId" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
                <child name="Identifier" ns="http://inspire.ec.europa.eu/schemas/base/3.3"/>
                <child name="namespace" ns="http://inspire.ec.europa.eu/schemas/base/3.3"/>
            </property>
        </target>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Ca38a7f6e-9aef-4804-b3a8-703f720e4aee" priority="normal">
        <target>
            <property>
                <type name="WaterwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-w/4.0"/>
                <child name="validFrom" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Cf578548d-b5b6-4f90-9d89-59fee7bbf1e4" priority="normal">
        <target>
            <property>
                <type name="WaterwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-w/4.0"/>
                <child name="validTo" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="unpopulated" name="value"/>
    </cell>
</alignment>
