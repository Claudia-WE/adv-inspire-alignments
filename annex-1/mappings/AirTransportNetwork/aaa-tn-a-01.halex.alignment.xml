<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<alignment xmlns="http://www.esdi-humboldt.eu/hale/alignment">
    <base prefix="ba2" location="../base-functions.halex.alignment.xml"/>
    <base prefix="ba1" location="../base-tn.halex.alignment.xml"/>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C1b49d11f-6391-4a48-b2d0-ff215716d3c2" priority="normal">
        <source>
            <property>
                <type name="AA_ObjektType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="lebenszeitintervall" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="AA_Lebenszeitintervall" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="beginnt" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="NetworkElementType" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
            </property>
        </target>
        <parameter value="false" name="structuralRename"/>
        <parameter value="false" name="ignoreNamespaces"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C52d452c3-a4d1-41f5-b239-de1564584cdb" priority="normal">
        <source>
            <property>
                <type name="AA_ObjektType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="lebenszeitintervall" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="AA_Lebenszeitintervall" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="endet" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="NetworkElementType" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
                <child name="endLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
            </property>
        </target>
        <parameter value="false" name="structuralRename"/>
        <parameter value="false" name="ignoreNamespaces"/>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.retype" id="Ccaa52a0b-aa46-4373-913d-d52ebe85743c" priority="normal">
        <source>
            <class>
                <type name="AX_FlugverkehrsanlageType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0">
                    <condition lang="CQL">art = '1310' or art = '5531'</condition>
                </type>
            </class>
        </source>
        <target>
            <class>
                <type name="RunwayAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-a/4.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
// nur Objekt mit flächenartigen Geometrien behandeln
def geometries = _.geom.findPolygons(_source.p.position.first())

// Ziel unterstützt keine MultiSurfaces
def surfaces = _.geom.splitMulti(geometries)

// Builder konfigurieren
// - Zuweisung der Geometrie auf Ebene von geometry zulassen
_b.strictValueFlags = false

// Identifier des Quell-Objekts
def sourceId = _source.p.id.value()

// Ziel-Objekt für jede Fläche erstellen
int num = 1
surfaces.each { surface -&gt;
	// ID bestimmen
	def _id = "RunwayArea_${sourceId}_${num}"
	def _ns = _project.vars.INSPIRE_NAMESPACE

	// Ziel-Objekt erstellen (IDs und Geometrie)
	_target {
		id( _id )
		inspireId {
			Identifier {
				localId( _id )
				namespace( _ns )
			}
		}
		identifier( _ns ? (_ns.endsWith('/') ? _ns : _ns + '/') + _id : _id ) {
			codeSpace( 'http://inspire.ec.europa.eu/ids' )
		}
		geometry(surface)
	}
	
	withTransformationContext {
		def collect = _.context.collector(it)
		// Sammle ID für Netzwerk
		collect.network &lt;&lt; _id
	}

	num++
}
</core:text>
        </complexParameter>
        <documentation>Erstellt `RunwayArea`s aus einer `AX_Flugverkehrsanlage` mit `art` *Startbahn/Landebahn* (`1310`) oder *Hubschrauberlandeplatz* (`5531`).

Die Geometrie des Quell-Objekts wird untersucht. Nur flächenartige Geometrien verwendet. Je Fläche wird eine `RunwayArea` erzeugt.

Die lokale ID wird aus dem Namen der Ziel-Objektart, der AAA-ObjektID des Quell-Objekts und einer aufsteigenden Nummer der Fläche (1., 2., etc. Fläche der Geometrie) gebildet.

Die erstellte `RunwayArea` wird dem Index von Netzwerk-Elementen hinzugefügt.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="Cd911918f-ab41-4a80-9dbb-1723e2b03b74" priority="normal">
        <source>
            <property>
                <type name="AX_FlugverkehrsanlageType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="bezeichnung" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RunwayAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-a/4.0"/>
                <child name="designator" ns="http://inspire.ec.europa.eu/schemas/tn-a/4.0"/>
            </property>
        </target>
        <parameter value="false" name="structuralRename"/>
        <parameter value="false" name="ignoreNamespaces"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C0c1014d7-111e-4e52-992d-bddb280e74a6" priority="normal">
        <target>
            <property>
                <type name="RunwayAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-a/4.0"/>
                <child name="designator" ns="http://inspire.ec.europa.eu/schemas/tn-a/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="unknown" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.classification" id="C01820847-6dfc-48e0-9fc5-145d4a0d46c3" priority="normal">
        <source>
            <property>
                <type name="AX_FlugverkehrsanlageType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="art" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RunwayAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-a/4.0"/>
                <child name="runwayType" ns="http://inspire.ec.europa.eu/schemas/tn-a/4.0"/>
                <child name="href" ns="http://www.w3.org/1999/xlink"/>
            </property>
        </target>
        <parameter value="null" name="notClassifiedAction"/>
        <complexParameter name="lookupTable">
            <lookup-table xmlns:ns2="http://www.esdi-humboldt.eu/hale/alignment" xmlns="">
                <entry>
                    <key value="1310"/>
                    <value value="http://inspire.ec.europa.eu/codelist/RunwayTypeValue/runway"/>
                </entry>
                <entry>
                    <key value="5531"/>
                    <value value="http://inspire.ec.europa.eu/codelist/RunwayTypeValue/FATO"/>
                </entry>
            </lookup-table>
        </complexParameter>
    </cell>
    <cell relation="custom:alignment:adv.inspire.GeographicalName.simple" id="Cc821f68c-572e-4c49-9b2f-c721bb98d6a5" priority="normal">
        <source name="spelling">
            <property>
                <type name="AX_FlugverkehrsanlageType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="name" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="TransportAreaType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </property>
        </target>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C8a99d139-a728-44e1-99c4-47b1ad65625d" priority="normal">
        <target>
            <property>
                <type name="TransportAreaType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="unknown" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C59f463b4-e885-4c0d-be10-9372532edeaf" priority="normal">
        <target>
            <property>
                <type name="TransportAreaType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="validFrom" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C847695bb-1eeb-4c82-9398-b6cb66a774da" priority="normal">
        <target>
            <property>
                <type name="TransportAreaType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="validTo" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="unpopulated" name="value"/>
    </cell>
</alignment>
